
@model Toeicking2021.Utilities.PaginatedList<Sentence>
@*要設一個跟ParentView匯出此PartialView位置<div>相同的id(change)在PartialView最上層容器中，才可replace with*@
<style>
    /*選擇器稍微選細一點，不然會影響到別的i元素*/
    .col-4 i {
        margin-left: 15px;
        /*改icon大小*/
        font-size: 1.5em;
    }

        .col-4 i:hover {
            color: #3ddcf7;
            transform: scale(1.5);
            transition: 0.3s;
        }

    /*.form-group.row.no-gutters {
        padding-top: 15px;
        padding-bottom: 15px;
    }*/

    /*.fa-database {
        color: #3ddcf7;
    }
    .fa-file-text {
        color: #d7b551;
    }
    .fa-language {
        color: #ef5350;
    }
    .fa-edit {
        color: #00b19d;
    }
    .fa-volume-up {
        color: #f76397;
    }
    .fa-trash-o {
        color: #f8f9fa;
    }*/


</style>

<div id="change" class="row">
    <div class="col-md-12">
        <div class="card-box">
            <!--footable套用-->
            <table id="demo-foo-filtering" class="table table-responsive table-bordered table-hover toggle-circle m-b-0">
                <!--表頭-->
                <thead>
                    <tr>
                        <!--泛型類別無法使用Html.DisplayNameFor()，因為點不出資料物件成員-->
                        <th data-toggle="true">編號</th>
                        <th>多益必考金句</th>
                        <th>中文翻譯</th>
                        <th>功能</th>
                        <!--data-hide="phone, tablet"在手機、平板會隱藏，data-hide="all"在所有裝置都會隱藏-->
                    </tr>
                </thead>
                <!--search套用不能拿掉，隱藏style="display: none;"-->
                <div class="form-inline m-b-20" style="display: none;">
                    <div class="row">
                        <div class="col-md-6 text-xs-center">
                            <div class="form-group">
                                <label class="control-label m-r-5">
                                    Status
                                </label>
                                <select id="demo-foo-filter-status" class="form-control input-sm">
                                    <option value="">Show all</option>
                                    <option value="active">Active</option>
                                    <option value="disabled">Disabled</option>
                                    <option value="suspended">Suspended</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6 text-center text-right">
                            <div class="form-group">
                                <input id="demo-foo-search" type="text" placeholder="Search" class="form-control" autocomplete="on">
                            </div>
                        </div>
                    </div>
                </div>

                <!--資料列-->
                <tbody id="table">
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>
                                <label id="@item.SentenceId" name="" class="sentence_id">@item.SentenceId</label>
                            </td>
                            <td>
                                <textarea id="@item.SentenceId" name="" class="form-control sentence" rows="4" style='width: 100%;'>@item.Sen</textarea>
                            </td>
                            <td>
                                <textarea id="@item.SentenceId" name="" class="form-control chinese" rows="4" style='width: 100%;'>@item.Chinesese</textarea>
                            </td>
                            <td>
                                <div class="form-group row no-gutters d-flex align-items-center" style="margin-bottom:20px; margin-top:15px;">
                                    <div class="col-4">
                                        @*同時有tooltip及開啟modal的data-toggle寫法*@
                                        <span @*data-toggle="modal" data-target="#sentence"*@>
                                            <a class="sentenceUpdate" data-toggle="tooltip" data-placement="top" title="句子修改">
                                                <i class="fa fa-database"></i>
                                            </a>
                                        </span>
                                    </div>
                                    <div class="col-4">
                                        <span data-toggle="modal" data-target="#grammar">
                                            <a class="grammarUpdate" data-toggle="tooltip" data-placement="top" title="文法解析檢視">
                                                <i class="fa fa-file-text"></i>
                                            </a>
                                        </span>
                                    </div>
                                    <div class="col-4">
                                        <span data-toggle="modal" data-target="#voc">
                                            <a class="vocUpdate" data-toggle="tooltip" data-placement="top" title="字彙檢視">
                                                <i class="fa fa-language"></i>
                                            </a>
                                        </span>
                                    </div>
                                </div>
                                <div class="form-group row no-gutters d-flex align-items-center"  >
                                    <div class="col-4">
                                        <span data-toggle="modal" data-target="#vocAnalysis">
                                            <a class="vocAnalysisUpdate" data-toggle="tooltip" data-placement="top" title="字彙解析檢視">
                                                <i class="fa fa-edit"></i>
                                            </a>
                                        </span>
                                    </div>
                                    <div class="col-4">
                                        <span data-toggle="modal" data-target="#audios">
                                            <a class="audioReview" data-toggle="tooltip" data-placement="top" title="音檔檢視">
                                                <i class="fa fa-volume-up"></i>
                                            </a>
                                        </span>
                                    </div>
                                    <div class="col-4">
                                        <span data-toggle="modal" data-target="#sentence">
                                            <a class="delete_check" data-toggle="tooltip" data-placement="top" title="刪除整列">
                                                <i class="fa fa-trash-o"></i>
                                            </a>
                                        </span>
                                    </div>
                                </div>
                            </td>
                        </tr>

                    }
                </tbody>
                <!--表尾分頁-->
                <tfoot>
                    <tr class="active">
                        <!--colspan的屬性值是表格的欄位數-->
                        <td colspan="4">
                            <div class="text-right">
                                <!--會固定存在與生成的標籤就不要放在foreach內(如ul和所有非頁碼的li)-->
                                <!--ul標籤中pagination拿掉才不會自動產生li，往右浮動style="float: right;-->
                                <ul class="pagination-split justify-content-end footable-pagination m-t-10 m-b-0">
                                    @*(Model.PageIndex > 1)為false代表現在為第一頁，加上disabled這個class，不能按第一頁*@
                                    <li class="footable-page-arrow @((Model.PageIndex > 1) ? "" : "disabled")">
                                        <!--第一頁標籤-->
                                        @*新版obtrusive語法要寫成data-ajax-mode="replace-with"*@
                                        <a class="skipOffset" data-page="first" asp-action="Render" asp-route-Page="1"
                                           asp-route-Keyword="@ViewBag.Keyword" asp-route-AddedDate="@ViewBag.AddedDate"
                                           asp-route-CountDesc="@ViewBag.CountDesc" asp-route-CheckedTimes="@ViewBag.CheckedTimes"
                                           asp-route-PageSize="@ViewBag.PageSize" asp-route-Part="@ViewBag.Part" asp-route-GrammarCategories="@ViewBag.GrammarCategories"
                                           asp-route-HasWordOrigin="@ViewBag.HasWordOrigin" asp-route-HasSynonym="@ViewBag.HasSynonym"
                                           asp-route-HasAudio="@ViewBag.HasAudio" asp-route-BoolConditions="@ViewBag.BoolConditions"
                                           asp-route-SkipOffset="000" data-ajax="true" data-ajax-complete="onComplete" data-ajax-mode="replace-with"
                                           data-ajax-update="#change">
                                            首頁
                                        </a>
                                    </li>
                                    @*(Model.PageIndex > 1)為false代表現在為第一頁，加上disabled這個class，不能按上一頁*@
                                    <li class="footable-page-arrow @((Model.PageIndex > 1) ? "" : "disabled")">
                                        <!--上一頁標籤-->
                                        <a class="skipOffset" data-page="prev" asp-action="Render" asp-route-Page="@(Model.PageIndex - 1)"
                                           asp-route-Keyword="@ViewBag.Keyword" asp-route-AddedDate="@ViewBag.AddedDate"
                                           asp-route-CountDesc="@ViewBag.CountDesc" asp-route-CheckedTimes="@ViewBag.CheckedTimes"
                                           asp-route-PageSize="@ViewBag.PageSize" asp-route-Part="@ViewBag.Part" asp-route-GrammarCategories="@ViewBag.GrammarCategories"
                                           asp-route-HasWordOrigin="@ViewBag.HasWordOrigin" asp-route-HasSynonym="@ViewBag.HasSynonym"
                                           asp-route-HasAudio="@ViewBag.HasAudio" asp-route-BoolConditions="@ViewBag.BoolConditions"
                                           asp-route-SkipOffset="000" data-ajax="true" data-ajax-complete="onComplete" data-ajax-mode="replace-with"
                                           data-ajax-update="#change">
                                            上一頁
                                        </a>
                                    </li>
                                    <!--這裡的for迴圈要生的是數字頁碼<li>(目前頁及其前後N頁，)，需跟Model繫結。
                                        注意迴圈數字是目前頁前"減N"後"加N+1"-->
                                    @for (var i = (Model.PageIndex - 5); i < (Model.PageIndex + 6); i++)
                                    {
                                        //在第一頁到最後一頁的範圍
                                        if ((i > 0) && (i <= Model.TotalPages))
                                        {
                                            // 生目前頁
                                            if (i == Model.PageIndex)
                                            {
                                                <li class="footable-page active">
                                                    <!--目前頁標籤(有active)-->
                                                    @*版型預設data-page屬性值比實際頁碼多1*@
                                                    <a data-page="@(i + 1)" href="#">@i</a>
                                                </li>
                                            }
                                            // 生非目前頁
                                            else
                                            {
                                                <li class="footable-page">
                                                    <!--不是目前頁的某一頁標籤-->
                                                    <a class="skipOffset" data-page="@(i + 1)" asp-action="Render" asp-route-Page="@i"
                                                       asp-route-Keyword="@ViewBag.Keyword" asp-route-AddedDate="@ViewBag.AddedDate"
                                                       asp-route-CountDesc="@ViewBag.CountDesc" asp-route-CheckedTimes="@ViewBag.CheckedTimes"
                                                       asp-route-PageSize="@ViewBag.PageSize" asp-route-Part="@ViewBag.Part" asp-route-GrammarCategories="@ViewBag.GrammarCategories"
                                                       asp-route-HasWordOrigin="@ViewBag.HasWordOrigin" asp-route-HasSynonym="@ViewBag.HasSynonym"
                                                       asp-route-HasAudio="@ViewBag.HasAudio" asp-route-BoolConditions="@ViewBag.BoolConditions"
                                                       asp-route-SkipOffset="000" data-ajax="true" data-ajax-complete="onComplete"
                                                       data-ajax-mode="replace-with" data-ajax-update="#change">
                                                        @i
                                                    </a>
                                                </li>
                                            }
                                        }
                                    }
                                    @*(Model.PageIndex < Model.TotalPages)為false代表現在是最後一頁，不能按下一頁*@
                                    <li class="footable-page-arrow @((Model.PageIndex < Model.TotalPages) ? "" : "disabled")">
                                        <!--下一頁標籤-->
                                        <a class="skipOffset" data-page="next" asp-action="Render" asp-route-Page="@(Model.PageIndex + 1)"
                                           asp-route-Keyword="@ViewBag.Keyword" asp-route-AddedDate="@ViewBag.AddedDate"
                                           asp-route-CountDesc="@ViewBag.CountDesc" asp-route-CheckedTimes="@ViewBag.CheckedTimes"
                                           asp-route-PageSize="@ViewBag.PageSize" asp-route-Part="@ViewBag.Part" asp-route-GrammarCategories="@ViewBag.GrammarCategories"
                                           asp-route-HasWordOrigin="@ViewBag.HasWordOrigin" asp-route-HasSynonym="@ViewBag.HasSynonym"
                                           asp-route-HasAudio="@ViewBag.HasAudio" asp-route-BoolConditions="@ViewBag.BoolConditions"
                                           asp-route-SkipOffset="000" data-ajax="true" data-ajax-complete="onComplete" data-ajax-mode="replace-with"
                                           data-ajax-update="#change">
                                            下一頁
                                        </a>
                                    </li>
                                    @*(Model.PageIndex < Model.TotalPages)為false代表現在是最後一頁，不能按最末頁*@
                                    <li class="footable-page-arrow @((Model.PageIndex < Model.TotalPages) ? "" : "disabled")">
                                        <!--最末頁標籤-->
                                        <a class="skipOffset" data-page="last" asp-action="Render" asp-route-Page="@Model.TotalPages"
                                           asp-route-Keyword="@ViewBag.Keyword" asp-route-AddedDate="@ViewBag.AddedDate"
                                           asp-route-CountDesc="@ViewBag.CountDesc" asp-route-CheckedTimes="@ViewBag.CheckedTimes"
                                           asp-route-PageSize="@ViewBag.PageSize" asp-route-Part="@ViewBag.Part" asp-route-GrammarCategories="@ViewBag.GrammarCategories"
                                           asp-route-HasWordOrigin="@ViewBag.HasWordOrigin" asp-route-HasSynonym="@ViewBag.HasSynonym"
                                           asp-route-HasAudio="@ViewBag.HasAudio" asp-route-BoolConditions="@ViewBag.BoolConditions"
                                           asp-route-SkipOffset="000" data-ajax="true" data-ajax-complete="onComplete" data-ajax-mode="replace-with"
                                           data-ajax-update="#change">
                                            末頁
                                            @*data-ajax-begin="onBegin" onclick="onBegin"*@
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>

@*顯示查詢結果*@
<input type="hidden" id="result" name="result" value="@ViewBag.result">

@*文法解析的modal*@
<div id="grammar" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">文法解析檢視與修改</h4>
            </div>
            @*埋usage-append這個class*@
            <div class="modal-body grammar-append">
                @*從這裡開始用jQuery生*@

                @*生到這*@
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">關閉</button>
                @*class為save-usage，儲存用法*@
                <button type="button" class="btn btn-info waves-effect waves-light save-grammar">存入資料庫</button>
            </div>
        </div>
    </div>
</div>
@*文法解析的modal*@

@*字彙的modal*@
<div id="voc" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">字彙檢視與修改</h4>
            </div>
            @*埋voc-append這個class*@
            <div class="modal-body voc-append">
                @*從這裡開始用jQuery生*@

                @*生到這*@
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">關閉</button>
                @*class為save-voc，儲存字彙*@
                <button type="button" class="btn btn-info waves-effect waves-light save-voc">存入資料庫</button>
            </div>
        </div>
    </div>
</div>
@*字彙的modal*@

@*字彙解析的modal*@
<div id="vocAnalysis" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">字彙解析檢視與修改</h4>
            </div>
            @*埋usage-append這個class*@
            <div class="modal-body vocAnalysis-append">
                @*從這裡開始用jQuery生*@

                @*生到這*@
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">關閉</button>
                @*class為save-usage，儲存用法*@
                <button type="button" class="btn btn-info waves-effect waves-light save-vocAnalysis">存入資料庫</button>
            </div>
        </div>
    </div>
</div>
@*字彙解析的modal*@

@*音檔檢視的modal*@
<div id="audios" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="custom-width-modalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog" style="width:55%;">
        @*埋一個modal-status的id，若無音檔時，利用這個id選取，顯示無音檔*@
        <div id="modal-status" class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="custom-width-modalLabel">音檔檢視</h4>
            </div>
            <div class="modal-body">
                <h4>美國腔(男)</h4>
                <audio controls src="~/voice_test/en-US-Wavenet-J.mp3" style="width:450px;"></audio>
                <hr>
                <h4>美國腔(女)</h4>
                <audio controls src="~/voice_test/en-US-Wavenet-E.mp3" style="width:450px;"></audio>
                <hr>
                <h4>英國腔(男)</h4>
                <audio controls src="~/voice_test/en-GB-Wavenet-B.mp3" style="width:450px;"></audio>
                <hr>
                <h4>英國腔(女)</h4>
                <audio controls src="~/voice_test/en-GB-Wavenet-C.mp3" style="width:450px;"></audio>
                <hr>
                <h4>澳洲腔(男)</h4>
                <audio controls src="~/voice_test/en-AU-Wavenet-B.mp3" style="width:450px;"></audio>
                <hr>
                <h4>澳洲腔(女)</h4>
                <audio controls src="~/voice_test/en-AU-Wavenet-C.mp3" style="width:450px;"></audio>
                <hr>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary waves-effect" data-dismiss="modal">關閉</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
@*音檔檢視的modal*@

@*自訂js*@
<script>

    // 要在分頁表格出現tooltip，必須寫在PartialView的<script>區塊中
    $('[data-toggle="tooltip"]').tooltip();

    // 若是PartialView裡的unobtrusive ajax需要呼叫的函式，就要寫在PartialView裡，寫在ParentView裡呼叫不到
    function onComplete() {
        // 換頁後移到畫面最上方
        $('html,body').animate({ scrollTop: 0 }, 500);
    }

    // 若查無資料
    if ($("#result").val() === "查無資料") {
        swal(
            {
                title: '糟糕',
                text: $("#result").val(),
                type: 'error'
            }
        );
    }

    // 1. 新增文法解析(觸發modal開啟的元素是<a>)
    $(".grammarUpdate").on("click", function () {
        $(".grammar-append").empty();
        // 取得句子編號
        var sentenceId = $(this).parent().parent().parent().parent().siblings().find(".sentence_id").text();
        // formData(沒有特別建一個型別)
        var formData = { sentenceId: sentenceId};
        $.ajax({
            type: "POST",
            url: "@Url.Content("~/Sentence/ReviewGrammar")",
            data: formData,
            success: function (response) {
                $(".grammar-append").append(response);
            },
            error: function (error) {
                swal(
                    {
                        title: '糟糕',
                        text: 'Ajax傳送出現錯誤！',
                        type: 'error'
                    }
                );
            }

        });

    });

    // 2. 新增字彙解析
    $(".vocAnalysisUpdate").on("click", function () {
        $(".vocAnalysis-append").empty();
        // 取得句子編號
        var sentenceId = $(this).parent().parent().parent().parent().siblings().find(".sentence_id").text();
        // formData(沒有特別建一個型別)
        var formData = { sentenceId: sentenceId};
        $.ajax({
            type: "POST",
            url: "@Url.Content("~/Sentence/ReviewVocAnalysis")",
            data: formData,
            success: function (response) {
                $(".vocAnalysis-append").append(response);
            },
            error: function (error) {
                swal(
                    {
                        title: '糟糕',
                        text: 'Ajax傳送出現錯誤！',
                        type: 'error'
                    }
                );
            }

        });

    });

    // 3. 新增字彙

    $(".vocUpdate").on("click", function () {
        $(".voc-append").empty();
        // 取得句子編號
        var sentenceId = $(this).parent().parent().parent().parent().siblings().find(".sentence_id").text();
        // formData(沒有特別建一個型別)
        var formData = { sentenceId: sentenceId};
        $.ajax({
            type: "POST",
            url: "@Url.Content("~/Sentence/ReviewVocabulary")",
            data: formData,
            success: function (response) {
                $(".voc-append").append(response);
            },
            error: function (error) {
                swal(
                    {
                        title: '糟糕',
                        text: 'Ajax傳送出現錯誤！',
                        type: 'error'
                    }
                );
            }

        });


    });

    // 4. 更新句子
    $(".sentenceUpdate").on("click", function () {
        swal({
            title: '注意',
            text: "確定要修改句子嗎？",
            type: 'warning',
            showCancelButton: true,
            //***swal按ok後ajax存入資料庫***
        }).then((result) => {
            if (result) {
                // 取得句子編號
                var sentenceId = $(this).parent().parent().parent().parent().siblings().find(".sentence_id").text();
                var sentence = $(this).parent().parent().parent().parent().siblings().find(".sentence").val();
                var chinese = $(this).parent().parent().parent().parent().siblings().find(".chinese").val();
                // formData(沒有特別建一個型別)
                var formData = { sentenceId: $.trim(sentenceId), sentence: $.trim(sentence), chinese: $.trim(chinese) };
                //ajax回傳資料
                $.ajax({
                    type: "POST",
                    url: "@Url.Content("~/Sentence/UpdateSentence")",
                    data: formData,
                    // 如果只是POST一個物件，不要加下一行，會傳不過去
                    //contentType: "application/x-www-form-urlencoded",
                    success: function (response) {
                        //取回傳的值用response，不要再用response.d
                        var swal_judge = response;
                        if (swal_judge == "1") {

                            swal(
                                {
                                    title: '完成',
                                    text: '更新資料成功！',
                                    type: 'success'
                                }

                            ).then((result) => {
                                if (result) {
                                    //將更新後的資料填進元素中
                                    $(this).parent().parent().parent().parent().siblings().find(".sentence_id").text(sentenceId);
                                    $(this).parent().parent().parent().parent().siblings().find(".sentence").val(sentence);
                                    $(this).parent().parent().parent().parent().siblings().find(".chinese").val(chinese);
                                }

                            });

                        } else if (swal_judge == "0") {
                            swal(
                                    {
                                        title: '糟糕',
                                        text: '查不到此筆資料！',
                                        type: 'error'
                                    }
                               );

                        } else {
                            swal(
                                    {
                                        title: '糟糕',
                                        text: swal_judge.toString(),
                                        type: 'error'
                                    }
                                );

                        }

                    },
                    error: function (error) {
                            swal(
                                    {
                                        title: '糟糕',
                                        text: 'Ajax傳送出現錯誤！',
                                        type: 'error'
                                    }
                                );

                    }


                });


            }

        });

    })

    // 5. 更新文法解析
    $(".save-grammar").on("click", function () {
        //先把按鈕存起來
        var thisBtn = $(this);
        swal({
            title: '注意',
            text: '確定要修改文法解析嗎？',
            type: 'warning',
            showCancelButton: true,

            //***swal按ok後ajax存入資料庫***
        }).then((result) => {
            if (result) {
                //是否要執行Ajax的變數，預設true
                var executeAjax = true;
                //先將控制項選取成集合(陣列)，放進變數中
                var grammarIds = $(this).parent().siblings().find(".modal_grammar_id");
                var grammars = $(this).parent().siblings().find(".modal_grammar");
                //再宣告要放進個控制項值的陣列
                var arrayGrammarIds = [];
                var arrayGrammars = [];
                //宣告空陣列裝要用ajax傳送的物件陣列
                var grammarData = [];
                //物件建構式
                function grammarObj(grammarId, grammar) {
                    //左邊AnalysisId是屬性，必須跟GA.cs的屬性名稱完全一樣，右邊是屬性值，為傳入的參數(名稱可自訂)。
                    this.AnalysisId = grammarId;
                    this.Analysis = grammar;
                }
                //檢查兩個集合數量是否相同
                if (grammarIds.length == grammars.length) {
                    //自設迴圈計數器
                    var i = 0;
                    //遍覽每個元素，準備給值
                    grammarIds.each(function () {
                        //檢查是否為空值
                        if ($(this).text() != "") {
                            //不是才放進集合中
                            arrayGrammarIds[i] = $(this).text();
                        }
                        else
                        {
                            swal(
                                {
                                    title: '糟糕',
                                    text: '字彙解析編號是空值',
                                    type: 'error'
                                }
                            );
                            //不執行ajax
                            executeAjax = false;
                        }
                        //不要忘記計數器要加1
                        i++;
                    });

                    var k = 0;
                    grammars.each(function () {
                        if ($.trim($(this).val()) != "") {
                            arrayGrammars[k] = $.trim($(this).val());
                        }
                        else
                        {
                            swal(
                                {
                                    title: '糟糕',
                                    text: '有用法內容是空值',
                                    type: 'error'
                                }
                            );
                            executeAjax = false;
                        }
                        k++;
                    });

                    //判斷是否要執行ajax
                    if (executeAjax == true) {
                        for (var i = 0; i < grammarIds.length; i++) {
                            //新增物件給值並裝進陣列，準備回傳
                            grammarData[i] = new grammarObj(arrayGrammarIds[i], arrayGrammars[i]);
                        }
                        //ajax回傳資料
                        $.ajax({
                            type: 'POST',
                            url: '@Url.Content("~/Sentence/UpdateGrammarPackage")',
                            dataType: 'json',
                            // JSON.stringify()的參數只要物件或物件集合就好，不要再加個key(屬性)去對應，這樣現有的類別即可轉換
                            // 否則C#序列化會出錯(除非再寫一個新類別去序列化)
                            data: JSON.stringify(grammarData),
                            contentType: 'application/json; charset=utf-8',
                            success: function (response) {
                                //response.d為webservice回傳的值
                                var swal_judge = response;
                                if (swal_judge == "1") {
                                    swal(
                                        {
                                            title: '完成',
                                            text: '更新資料成功！',
                                            type: 'success'
                                        }

                                    ).then((result) => {
                                        if (result) {
                                            //找到x按鈕，執行按鈕動作，關掉modal
                                            $(thisBtn).parent().siblings().find(".close").click();
                                        }

                                    });

                                }
                                else if (swal_judge == "0")
                                {
                                    swal(
                                        {
                                            title: '糟糕',
                                            text: '查不到此筆資料！',
                                            type: 'error'
                                        }
                                    );

                                }

                            },
                            error: function (error) {
                                swal(
                                    {
                                        title: '糟糕',
                                        text: swal_judge.toString(),
                                        type: 'error'
                                    }
                                );

                            }

                        });

                    }

                }
                else
                {
                    swal(
                        {
                            title: '糟糕',
                            text: '控制項值的數量彼此不一致！',
                            type: 'error'
                        }
                    );
                    executeAjax = false;

                }

            }

        });

    });

    // 6. 更新字彙解析
    $(".save-vocAnalysis").on("click", function () {
        //先把按鈕存起來
        var thisBtn = $(this);
        swal({
            title: '注意',
            text: "確定要修改用法嗎？",
            type: 'warning',
            showCancelButton: true,

            //***swal按ok後ajax存入資料庫***
        }).then((result) => {
            if (result) {
                //是否要執行Ajax的變數，預設true
                var executeAjax = true;
                //先將控制項選取成集合(陣列)，放進變數中
                var vocAnalysisIds = $(this).parent().siblings().find(".modal_vocAnalysis_id");
                var vocAnalyses = $(this).parent().siblings().find(".modal_vocAnalysis");
                //再宣告要放進個控制項值的陣列
                var arrayVocAnalysisIds = [];
                var arrayVocAnalyses = [];
                //宣告空陣列裝要用ajax傳送的物件陣列
                var vocAnalysisData = [];
                //物件建構式
                function vocAnalysisObj(vocAnalysisId, vocAnalysis) {
                    //左邊usage_id是屬性，必須跟Model類別的屬性名稱完全一樣，右邊是屬性值，為傳入的參數(名稱可自訂)。
                    this.AnalysisId = vocAnalysisId;
                    this.Analysis = vocAnalysis;
                }
                //檢查兩個集合數量是否相同
                if (vocAnalysisIds.length == vocAnalyses.length) {
                    //自設迴圈計數器
                    var i = 0;
                    //遍覽每個元素，準備給值
                    vocAnalysisIds.each(function () {
                        //檢查是否為空值
                        if ($(this).text() != "") {
                            //不是才放進集合中
                            arrayVocAnalysisIds[i] = $(this).text();
                        }
                        else
                        {
                            swal(
                                {
                                    title: '糟糕',
                                    text: '有字彙解析編號是空值',
                                    type: 'error'
                                }
                            );
                            //不執行ajax
                            executeAjax = false;
                        }
                        //不要忘記計數器要加1
                        i++;
                    });
                    var k = 0;
                    vocAnalyses.each(function () {
                        if ($.trim($(this).val()) != "") {
                            arrayVocAnalyses[k] = $.trim($(this).val());
                        }
                        else
                        {
                            swal(
                                {
                                    title: '糟糕',
                                    text: '有字彙解析內容是空值',
                                    type: 'error'
                                }
                            );
                            executeAjax = false;
                        }
                        k++;
                    });
                    //判斷是否要執行ajax
                    if (executeAjax == true) {
                        for (var i = 0; i < vocAnalysisIds.length; i++) {
                            //新增物件給值並裝進陣列，準備回傳
                            vocAnalysisData[i] = new vocAnalysisObj(arrayVocAnalysisIds[i], arrayVocAnalyses[i]);
                        }
                        //ajax回傳資料
                        $.ajax({
                            type: 'POST',
                            url: '@Url.Content("~/Sentence/UpdateVocAnalysisPackage")',
                            dataType: 'json',
                            data: JSON.stringify(vocAnalysisData),
                            contentType: 'application/json; charset=utf-8',
                            success: function (response) {
                                var swal_judge = response;
                                if (swal_judge == "1") {

                                    swal(
                                        {
                                            title: '完成',
                                            text: '更新資料成功！',
                                            type: 'success'
                                        }

                                    ).then((result) => {
                                        if (result) {
                                            //找到x按鈕，執行按鈕動作，關掉modal
                                            $(thisBtn).parent().siblings().find(".close").click();
                                        }

                                    });

                                } else if (swal_judge == "0")
                                {
                                    swal(
                                        {
                                            title: '糟糕',
                                            text: '查不到此筆資料！',
                                            type: 'error'
                                        }
                                    );

                                }

                            },
                            error: function (error) {

                                swal(
                                    {
                                        title: '糟糕',
                                        text: swal_judge.toString(),
                                        type: 'error'
                                    }
                                );
                            }

                        });

                    }

                }
                else
                {
                    swal(
                        {
                            title: '糟糕',
                            text: '控制項值的數量彼此不一致！',
                            type: 'error'
                        }
                    );
                    executeAjax = false;
                }

            }

        });

    });

    // 7. 更新字彙
    $(".save-voc").on("click", function () {
        //先把按鈕存起來
        var thisBtn = $(this);
        swal({
            title: '注意',
            text: "確定要修改字彙嗎？",
            type: 'warning',
            showCancelButton: true,

            //***swal按ok後ajax存入資料庫***
        }).then((result) => {
            if (result) {
                //是否要執行Ajax的變數，預設true
                var executeAjax = true;
                //先將控制項選取成集合(陣列)，放進變數中
                var vocIds = $(this).parent().siblings().find(".modal_voc_id");
                var vocs = $(this).parent().siblings().find(".modal_voc");
                var categories = $(this).parent().siblings().find(".modal_category");
                var chinese = $(this).parent().siblings().find(".modal_chinese");
                //再宣告要放進個控制項值的陣列
                var arrayVocIds = [];
                var arrayVocs = [];
                var arrayCategories = [];
                var arrayChinese = [];
                //宣告空陣列裝要用ajax傳送的物件陣列
                var vocData = [];
                //物件建構式
                function vocObj(vocId, voc, category, chinese) {
                    //左邊voc_id是屬性，必須跟webservice裡類別的屬性名稱完全一樣，右邊是屬性值，為傳入的參數(名稱可自訂)。
                    this.VocabularyId = vocId;
                    this.Voc = voc;
                    this.Category = category;
                    this.Chinese = chinese;
                }
                if (vocIds.length == vocs.length && vocs.length == categories.length && categories.length == chinese.length) {
                    //自設迴圈計數器
                    var i = 0;
                    //遍覽每個元素，準備給值
                    vocIds.each(function () {
                        //檢查是否為空值
                        if ($(this).text() != "") {
                            //不是才放進集合中
                            arrayVocIds[i] = $(this).text();
                        }
                        else
                        {
                            swal(
                                {
                                    title: '糟糕',
                                    text: '有字彙編號是空值',
                                    type: 'error'
                                }
                            );
                            //不執行ajax
                            executeAjax = false;
                        }
                        //不要忘記計數器要加1
                        i++;
                    });
                    //自設迴圈計數器
                    var p = 0;
                    //遍覽每個元素，準備給值
                    vocs.each(function () {
                        //檢查是否為空值
                        if ($.trim($(this).val()) != "") {
                            //不是才放進集合中
                            arrayVocs[p] = $.trim($(this).val());
                        }
                        else
                        {
                            swal(
                                {
                                    title: '糟糕',
                                    text: '有字彙是空值',
                                    type: 'error'
                                }
                            );
                            //不執行ajax
                            executeAjax = false;
                        }
                        //不要忘記計數器要加1
                        p++;
                    });
                    //自設迴圈計數器
                    var k = 0;
                    //遍覽每個元素，準備給值
                    categories.each(function () {
                        //檢查是否為空值
                        if ($(this).val() != "") {
                            //不是才放進集合中
                            arrayCategories[k] = $(this).val();
                        }
                        else
                        {
                            swal(
                                {
                                    title: '糟糕',
                                    text: '有詞性是空值',
                                    type: 'error'
                                }
                            );
                            //不執行ajax
                            executeAjax = false;
                        }
                        //不要忘記計數器要加1
                        k++;
                    });
                    //自設迴圈計數器
                    var t = 0;
                    //遍覽每個元素，準備給值
                    chinese.each(function () {
                        //檢查是否為空值
                        if ($.trim($(this).val()) != "") {
                            //不是才放進集合中
                            arrayChinese[t] = $.trim($(this).val());

                        }
                        else
                        {
                            swal(
                                {
                                    title: '糟糕',
                                    text: '有中文是空值',
                                    type: 'error'
                                }
                            );
                            //不執行ajax
                            executeAjax = false;
                        }
                        //不要忘記計數器要加1
                        t++;
                    });
                    //判斷是否要執行ajax
                    if (executeAjax == true) {

                        for (var i = 0; i < vocIds.length; i++) {
                            //新增物件給值並裝進陣列，準備回傳
                            vocData[i] = new vocObj(arrayVocIds[i], arrayVocs[i], arrayCategories[i], arrayChinese[i]);
                        }
                        //ajax回傳資料
                        $.ajax({
                            type: 'POST',
                            url: '@Url.Content("~/Sentence/UpdateVocabularyPackage")',
                            dataType: 'json',
                            //傳送資料以json格式:{屬性:屬性值}，屬性的名稱必須跟web service裡方法參數名稱一樣(除了string和int外，其它型別要對應)
                            data: JSON.stringify(vocData),
                            contentType: 'application/json; charset=utf-8',
                            success: function (response) {
                                var swal_judge = response;
                                if (swal_judge == "1") {
                                    swal(
                                        {
                                            title: '完成',
                                            text: '更新資料成功！',
                                            type: 'success'
                                        }
                                    ).then((result) => {
                                        if (result) {
                                            //找到x按鈕，執行按鈕動作，關掉modal
                                            $(thisBtn).parent().siblings().find(".close").click();
                                        }

                                    });

                                } else if (swal_judge == "0")
                                {
                                    swal(
                                        {
                                            title: '糟糕',
                                            text: '查不到此筆資料！',
                                            type: 'error'
                                        }
                                    );

                                }

                            },
                            error: function (error) {
                                swal(
                                    {
                                        title: '糟糕',
                                        text: swal_judge.toString(),
                                        type: 'error'
                                    }
                                );
                            }

                        });

                    }

                } else
                {
                    swal(
                        {
                            title: '糟糕',
                            text: '控制項值的數量彼此不一致！',
                            type: 'error'
                        }
                    );
                    executeAjax = false;
                }

            }

        });

    });

    // 8. 音檔檢視
    $(".audioReview").on("click", function () {

    });

    // 9. 移除整列並checktime加1
    $(".delete_check").on("click", function () {
        swal({
            title: '注意',
            text: "確定要移除整列嗎？",
            type: 'warning',
            showCancelButton: true,
            //***swal按ok後移除該列***
        }).then((result) => {
            if (result) {
                // 用ajax設定DB中checked的值(找出SentenceId後傳回)
                // 取得句子編號
                var sentenceId = $(this).parent().parent().parent().parent().siblings().find(".sentence_id").text();
                // formData(沒有特別建一個型別)
                var formData = { sentenceId: sentenceId};
                $.ajax({
                    type: "POST",
                    url: "@Url.Content("~/Sentence/AddCheckTime")",
                    data: formData,
                    success: function (response) {
                        alert(response.toString());
                        // 取得現有的skipOffset筆數
                        var temp = $("#skip-offset").val();
                        // 加1後放在隱藏欄位(ParentView中)
                        $("#skip-offset").val((parseInt(temp) + 1).toString());
                        alert("skipOffset數量:" + $("#skip-offset").val());
                    },
                    error: function (error) {
                        swal(
                            {
                                title: '糟糕',
                                text: error.toString(),
                                type: 'error'
                            }
                        );
                    }

                });
                //// 選取<tr>淡出
                //$(this).parent().parent().parent().parent().parent().fadeOut(1000);

            }

        });

    });

    // <a>設click事件，動態置換asp-route-SkipOffset的值
    $(".skipOffset").on("click", function (e) {
        // alert("進來了")
        // 停止預設行為，參數e要記得在function地方傳入
        e.preventDefault();
        // 取得url字串
        var url = $(this).attr("href");
        // alert($("#skip-offset").val());
        //將原本取得url字串中的dummy換成隱藏欄位的值
        url = url.replace("000", $("#skip-offset").val());
        // alert(url);
        // ajax按鈕不要寫下面那行，否則不會執行
        // window.location.href = url;
    });





</script>

